---
title: "Get started with rcites"
author: "rcites team"
date: 10-08-2018
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Get started with rcites}
  %\VignetteEngine{knitr::rmarkdown}
---


```{r setup, echo = FALSE}
NOT_CRAN <- FALSE
# NOT_CRAN <- identical(tolower(Sys.getenv("NOT_CRAN")), "true")
knitr::opts_chunk$set(
  purl = NOT_CRAN,
  eval = NOT_CRAN,
  fig.align = "center",
  comment = "#> "
)
```



# Set up a connection to the Species+/CITES Checklist API

## Get your personal token

To set up a connection to the Species+/CITES Checklist API, an authentication token
is required. Each user should obtain his or her own personal token
to run the code below (see https://api.speciesplus.net/documentation for more details). To obtain a token, sign up on the [Species+ API website](http://api.speciesplus.net/users/sign_up).

## Set the token

Now, we assume that you already have a token. For illustrative purposes,
we will use the generic token value `8QW6Qgh57sBG2k0gtt` for the API
documentation.

A token is mandatory and needs to be passed to the header of all URL
requests. They are three different ways to set the token in `rcites`:

1. set an environment variable `SPECIESPLUS_TOKEN` in
[`.Renviron`](https://stat.ethz.ch/R-manual/R-devel/library/base/html/Startup.html)
file (preferred);

2. use `set_token()` to set up the token as character string (with quotes). If not entered in the function, the token can be passed without quotes (not as character string) after a prompt. This way, the token `SPECIESPLUS_TOKEN` is interactively set up for the current R session (meaning a login will be required for the future R sessions);

```{r, eval = FALSE}
library(rcites)
set_token("8QW6Qgh57sBG2k0gtt")
```

```{r, echo = FALSE}
load_all()
```

3. use the `token` argument of the functions, *i.e.* the token is passed manually to each function call.

Note that if set the token wrongly and wish for setting it again interactively,
you must first forget the previous one with `forget_token()`.

# Use of key features

## Retrieve a taxon identifiers with spp_taxonconcept()

### Basic calls to spp_taxonconcept()

In order to efficiently query information from the CITES database, you
first need to retrieve the unique taxon identifier `taxon_id` from the [Species+ taxon concept](https://api.speciesplus.net/documentation/v1/taxon_concepts/index.html).
To do so, you should first call `spp_taxonconcept()` and provide the scientific
name of the taxon you look for. Let us start by requesting the identifier of the African bush elephant, *i.e.* *Loxodonta africana*.

```{r result_1}
res1 <- spp_taxonconcept(query_taxon = "Loxodonta africana")
```

Note that if you chose chose option 3, then the code should look like the one below:

```{r, eval = FALSE}
res1 <- spp_taxonconcept(query_taxon = "Loxodonta africana", token = "8QW6Qgh57sBG2k0gtt")
```

### Object `spp_taxonconcept`

`res1` is an S3 object of class `spp_taxon`:

```{r res1_attr}
attributes(res1)
```

that contains information sorted into several data frames (see `?spp_taxonconcept`):


```{r res1_names}
res1
```

For some taxa, there are more than one taxon identifier available. In `general` only
*active* identifiers are listed, the the full list of identifier is
available in `all_id`:

```{r res3}
res3 <- spp_taxonconcept(query = "Amazilia versicolor")#, appendix_only = TRUE)
res3$general
res3$all_id
```

Also, if the taxon is not listed, a warning message should come up.

```{r}
res4 <- spp_taxonconcept(query = "Homo Sapiens")
```

### Custom calls to spp_taxonconcept()

`spp_taxonconcept()` includes several argument to retrieve a specific subset
of information (see `?spp_taxonconcept` for more details):

```{r args_spp_taxonconcept}
args('spp_taxonconcept')
```

Most importantly, the argument `taxonomy` allows a selection between the two
databases (CITES or CMS):

```{r taxo_cms}
spp_taxonconcept(query = "Amazilia versicolor", taxonomy = "CMS")
spp_taxonconcept(query = "Loxodonta africana", taxonomy = "CMS")
```

`language` and `updated_since` are convenient filters restrictively for
the written language of common names (must be a
two-letters code see [ISO 3166-1 alpha-2](https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2))
and the last update of the entries:

```{r filter}
spp_taxonconcept(query_taxon = "Loxodonta africana", language = 'EN',
  updated_since = "2016-01-01")
```

## Retrieve a taxon identifiers with

To use the four `spp_*` functions one need to use the *active taxon identifier*,
so for the two species we used as example so far, this means 4521 and 3210

|name                | taxon identifier|
|:-------------------|:----------------|
|Loxodonta africana  |       4521      |
|Amazilia versicolor |       3210      |



### CITES legislation data

```{r}
spp_cites_legislation(taxon_id = "4521", verbose = FALSE)
```


### EU legislation data

```{r}
spp_eu_legislation(taxon_id = "4521",  verbose = FALSE)
```

```{r}
spp_eu_legislation(taxon_id = "3210", scope = "all", verbose = FALSE)
```


### Distribution data

```{r}
spp_distributions("4521", verbose = FALSE)
```

### References

```{r}
spp_references("4521", verbose = FALSE)
```
