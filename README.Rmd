---
title: "'citesr': R client for the CITES species+ API"
output:
    md_document
---


```{r echo=FALSE}
knitr::opts_chunk$set(
  fig.path = "inst/assets/img/",
  comment = "#R> ",
  fig.width = 6,
  fig.height = 7.6
)
```

# 'citesr': R client for the CITES species+ API

An R package to access the CITES Species+ database. Reference:
UNEP (2017). The Species+ Website. Nairobi, Kenya. Compiled by UNEP-WCMC,
Cambridge, UK. Available at: www.speciesplus.net. [Accessed 18/02/2017].

## Current Status

![](https://img.shields.io/badge/citesr-InDevelopment-d7ae67.svg)
[![Build Status](https://travis-ci.org/ibartomeus/citesr.svg?branch=master)](https://travis-ci.org/ibartomeus/citesr)
[![Build status](https://ci.appveyor.com/api/projects/status/j8u04bwan0kqpn0f?svg=true)](https://ci.appveyor.com/project/KevCaz/citesr)
[![codecov](https://codecov.io/gh/ibartomeus/citesr/branch/master/graph/badge.svg)](https://codecov.io/gh/ibartomeus/citesr)


## How it works

### Get a token

So far, the user must get its own authentication token, *i.e.* it must
signed up on the species+/cites website: https://api.speciesplus.net/.
You basically have three options once you got the token:

1. set an environment variable `SPPPLUS_TOKEN` in your [`.Renviron`](https://stat.ethz.ch/R-manual/R-devel/library/base/html/Startup.html) file (preferred);

2. use `sppplus_login()`; you will be able to interactively set up `SPPPLUS_TOKEN`
for the current R session (meaning you will have to do it again during the next session).

3. use the `token` argument of the functions, *i.e.* pass the token to all of your
function calls.


For the sack of clarity we use a variable `token` below. If you have opted
for 1 or 2 then you can ignore this parameter (*i.e.* `token=NULL`). Note that value
`8QW6Qgh57sBG2k0gtt` is not working, it is actually the one displayed on the
species plus website, see https://api.speciesplus.net/documentation.



### Installation of our R client

So far the installation requires the `devtools` package:

```R
devtools::install_github("ibartomeus/citesr")
library("citesr")
token <- "8QW6Qgh57sBG2k0gtt"
# alternatively use `sppplus_login` and ignore `token`
```

```{R token, echo = FALSE}
token <- readRDS("inst/tmp/token.rds")
```

### Examples

#### `sppplus_taxonconcept()`

```{R status}
# get all fields in nested list format
sppplus_taxonconcept(query = "Loxodonta africana", token, appendix_only = TRUE)
```

```{R status2}
# also works at higher order taxonomy
sppplus_taxonconcept(query = "Mammalia", token, appendix_only = TRUE)
```



#### `sppplus_distribution()`

```{R distribution}
# get distribution information
dis <- taxon_distribution(tax_id = '4521', token, collapse_tags = ' + ')
head(dis)
```

#### `taxon_cites_legislation()`

```{R legislation}
# you can ask for the CITES legislation information, e.g. listings
leg <- taxon_cites_legislation(tax_id = "4521", token, type = "listings")
leg$cites_listings[1L, 1L:6L]
```

#### `taxon_eu_legislation()`

```{R legislation_eu}
# you can ask for the CITES legislation information, e.g. listing
leg_eu <- taxon_eu_legislation(tax_id = "4521", token, type = "decisions")
leg_eu$eu_decisions[1L, 1L:6L]
unlist(leg_eu$eu_decisions[1L, 6L])
```

#### `taxon_references()`

```{R references}
ref <- taxon_references(tax_id = '4521', token, type = 'taxonomic')
dim(ref)
ref$taxonomic[1L, ]
```



#### Distribution map

The example below requires `rworldmap`.

```{R map, message = FALSE}
suppressPackageStartupMessages(library(rworldmap))
map1 <- as.data.frame(taxon_distribution('4521', token))
map2 <- joinCountryData2Map(map1, joinCode="ISO2", nameJoinColumn = "iso_code2", nameCountryColumn = "name")
map2@data$iso2 <- unlist(lapply(map2$iso_code2, is.null))
plot(c(-23, 62), c(45, -40), type = "n", main = "Loxodonta africana",
  xlab = "Longitude (°C)", ylab = "Latitude (°C)")
plot(map2, add = T)
plot(map2[!map2$iso2,], col = "#bd9a5e", add = T)
```

Please note that this project is released with a [Contributor Code of Conduct](CONDUCT.md).
By participating in this project you agree to abide by its terms.
